# 🔄 MegaNodes API - Callback Requests

This page explains all **Callback Requests** sent by the MegaNodes API when operating in **Seamless Mode**.  

> If you use **Money Transfer Mode**, you do not need to read this page.

All callback requests are sent as **JSON data** using the **POST** method.

---

## 🔁 Retry Request Process

| Action | Retry Strategy |
|--------|----------------|
| Balance deposit (win, cancel) | First request + 3 retries every 2-4 seconds |
| Balance confirmation (balance) | First request + 2 retries |
| Balance withdraw (bet) | First request + forward cancellation request |

---

## 🧾 Request Headers

| Key | Value | Description |
|-----|-------|-------------|
| **Callback-Token** | `[CALLBACK_TOKEN]` | Token issued by our API, found in **[Settings]** of Back Office |
| **Accept** | application/json | JSON data |
| **Content-Type** | application/json | JSON data |

---

## ✅ Verifying Callback Token

1. Ensure the `CALLBACK_TOKEN` in the header matches your configured **Callback Token**.  
2. If verification fails, respond with:

```json
{ "result": 100, "status": "ERROR" }
```

---

## 🔁 Retry Request Process

All requests include 4 main keys:

```
{
  "command": "authenticate",
  "data": { "account": "test1234" },
  "timestamp": "1676116606",
  "check": "21"
}
```

| Key | Description |
|--------|----------------|
| command | Specifies the action your server must perform (e.g., authenticate, update balance, etc.) |
| data | JSON object containing information required to process the request (e.g., player ID, transaction amounts) |
| timestamp | Unix timestamp of the request, useful for logging and tracking |
| check | Verification type(s). Can be multiple values separated by commas (e.g., "21,22,31") |

---

📂 Callback Request Types

1. User Authentication

Sent to verify a player, such as when creating a new user or launching a game.

```
{
  "command": "authenticate",
  "data": { "account": "test1234" },
  "timestamp": "1676116606",
  "check": "21"
}
```

2. Confirmation of Balance Amount

Sent to retrieve a player's balance during active gameplay.

```
{
  "command": "balance",
  "data": { "account": "test1234" },
  "timestamp": "1600000001",
  "check": "21,22"
}
```

3. Betting Request

Sent when a player places a bet. trans_id is unique for each transaction, round_id may appear in both bet and win transactions.

```
{
  "command": "bet",
  "data": {
    "account": "test1234",
    "trans_id": 1676358190,
    "call_id": 0,
    "round_id": "818395446",
    "provider_id": 1,
    "game_code": "vswaysdogs",
    "game_name": "The Dog House Megaways",
    "game_type": "Slots",
    "amount": 1000,
    "type": 1
  },
  "timestamp": "1600000001",
  "check": "21,22,41,31"
}
```

4. Handling Betting Results (Win/Loss)

Sent when a user wins or loses. Both use the command value "win".

```
{
  "command": "win",
  "data": {
    "account": "test1234",
    "trans_id": 1676358191,
    "call_id": 0,
    "round_id": "818395446",
    "provider_id": 1,
    "game_code": "vswaysdogs",
    "game_name": "The Dog House Megaways",
    "game_type": "Slots",
    "amount": 1000,
    "type": 2
  },
  "timestamp": "1600000001",
  "check": "21,22,41"
}
```

5. Individual Cancellation of Betting/Result

Sent to cancel a previous transaction if it fails due to network issues or errors.

Triggered When:

- Previous command times out

- 500 error returned from your backend

```
{
  "command": "cancel",
  "data": {
    "account": "test1234",
    "trans_id": 1676358190,
    "round_id": "818395446",
    "provider_id": 1,
    "game_code": "vswaysdogs",
    "game_name": "The Dog House Megaways",
    "game_type": "Slots"
  },
  "timestamp": "1600000001",
  "check": "21,22,42"
}
```

6. Processing Status

Sent to verify whether a transaction was successfully processed.

```
{
  "command": "status",
  "data": { "account": "test1234", "trans_id": 1676358190 },
  "timestamp": "1600000001",
  "check": "21,42"
}
```

---

> For instructions on how to parse and respond to callback requests, see the [Callback Responses](./08.callback-responses.md)
